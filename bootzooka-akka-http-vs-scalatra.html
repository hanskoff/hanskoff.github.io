<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Performance akka-http vs scalatra - johny's blog</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="https://hanskoff.github.io/bootzooka-akka-http-vs-scalatra.html">

        <meta name="author" content="johny" />
        <meta name="keywords" content="bootzooka,scala,scalatra,akka-http,gatling" />
        <meta name="description" content="Some time ago we changed how Bootzooka handles HTTP requests. My goal is to compare two great tools: complete web framework scalatra 2.3.1 (latest stable) called by one of it&#39;s project leaders a web toolkit akka-http 2.4.2 from a performance perspective. I find both of ..." />

        <meta property="og:site_name" content="johny's blog" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Performance akka-http vs scalatra"/>
        <meta property="og:url" content="https://hanskoff.github.io/bootzooka-akka-http-vs-scalatra.html"/>
        <meta property="og:description" content="Some time ago we changed how Bootzooka handles HTTP requests. My goal is to compare two great tools: complete web framework scalatra 2.3.1 (latest stable) called by one of it&#39;s project leaders a web toolkit akka-http 2.4.2 from a performance perspective. I find both of ..."/>
        <meta property="article:published_time" content="2016-03-29" />
            <meta property="article:section" content="bootzooka" />
            <meta property="article:tag" content="bootzooka" />
            <meta property="article:tag" content="scala" />
            <meta property="article:tag" content="scalatra" />
            <meta property="article:tag" content="akka-http" />
            <meta property="article:tag" content="gatling" />
            <meta property="article:author" content="johny" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://hanskoff.github.io/theme/css/bootstrap.flatly.min.css" type="text/css"/>
    <link href="https://hanskoff.github.io/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://hanskoff.github.io/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="https://hanskoff.github.io/theme/css/style.css" type="text/css"/>





</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://hanskoff.github.io/" class="navbar-brand">
johny's blog            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="https://hanskoff.github.io/pages/about.html">
                             About
                          </a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="https://hanskoff.github.io/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <ol class="breadcrumb">
                <li><a href="https://hanskoff.github.io" title="johny's blog"><i class="fa fa-home fa-lg"></i></a></li>
                <li class="active">Performance akka-http vs scalatra</li>
            </ol>
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://hanskoff.github.io/bootzooka-akka-http-vs-scalatra.html"
                       rel="bookmark"
                       title="Permalink to Performance akka-http vs scalatra">
                        Performance akka-http vs scalatra
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2016-03-29T11:28:00+02:00"> Tue 29 March 2016</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="https://hanskoff.github.io/tag/bootzooka.html">bootzooka</a>
        /
	<a href="https://hanskoff.github.io/tag/scala.html">scala</a>
        /
	<a href="https://hanskoff.github.io/tag/scalatra.html">scalatra</a>
        /
	<a href="https://hanskoff.github.io/tag/akka-http.html">akka-http</a>
        /
	<a href="https://hanskoff.github.io/tag/gatling.html">gatling</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p><a href="https://softwaremill.com/bootzooka-akka-http-based/">Some time ago we changed how Bootzooka handles HTTP requests.</a></p>
<p>My goal is to compare two great tools:</p>
<ol>
<li>complete web framework <a href="http://scalatra.org/">scalatra 2.3.1</a> (latest stable)</li>
<li>called by one of it's project leaders a web toolkit <a href="http://doc.akka.io/docs/akka/2.4.2/scala/http/">akka-http 2.4.2</a></li>
</ol>
<p>from a performance perspective. I find both of them very helpful but they work in different ways so the idea is to see how much that impacts the application and it's users. </p>
<p>Whenever you buy a car - you look at its specification. How fast it is, how amazing is the acceleration, how much petrol does it burn, how much load it can carry. I'd like to know such metrics for tools I use to build web applications. Authors don't always publish such metrics and often Google doesn't find any. One such metric would be to compare benchmarks but there are none so let’s make a comparison.</p>
<p>From the Great Jez Humble's Continuous Delivery book, introduction to chapter 9, comes the definition of app performance:</p>
<blockquote>
<p>First of all, let’s clear up some confusion around the terms. We’ll use the same terminology as Michael Nygard.1 To paraphrase, performance is a measure of the time taken to process a single transaction, and can be measured either in isolation or under load. Throughput is the number of transactions a system can process in a given timespan. It is always limited by some bottleneck in the system.
The maximum throughput a system can sustain, for a given workload, while maintaining an acceptable response time for each individual request, is its capacity.
Customers are usually interested in throughput or capacity. In real life, “performance” is often used as a catch-all term; we will try to be rather more careful in this chapter.</p>
</blockquote>
<p>So I’ll try to find <strong>throughput</strong> and <strong>capacity</strong> for each versions of bootzooka.</p>
<h3>Brief details of tested tools internals</h3>
<p>The version of Scalatra that I've tested works in synchronous &amp; blocking way while akka-http is by default "reactive" (asynchronous and non-blocking - ”reactive” trait might be easily lost when the implementation is blocking, so our code also needs to process asnychronously).</p>
<p>Scalatra is thread based, handling servlets and requires servlet container like jetty to run, it can delegate work to akka (from it’s docs, never tried this one), while akka-http is actor per request, doesn't require a container and writing actor model code is more natural pattern to follow in this case. Both have comparably pleasant DSLs for writing routes.</p>
<h3>Setup</h3>
<p>Equipped with <a href="http://gatling.io">gatling.io</a> (for generating fake traffic of user scenarios) and GCViewer (for watching a memory consumption, this is influenced by <a href="http://bandrzejczak.com/blog/2015/02/15/the-cost-of-the-garbage-collection/">Bartek's post</a> to see if something spectacular is going on) I can measure what happens to my beloved framework (bootzooka) after switching web frameworks. </p>
<p>The test was performed on macbook pro, 2,5 GHz Intel Core i7 with 16 GB of ram.
I use default JVM flags what is Xss=1 MB (thread stack size) and InitialHeapSize ~ 260 MB and Xmx ~ 4 GB (note: heroku 1 dyno standard is 350 MB). </p>
<div class="highlight"><pre><span></span>$ java -XX:+PrintFlagsFinal version 
    uintx InitialHeapSize                          :<span class="o">=</span> <span class="m">268435456</span>                           
    uintx MaxHeapSize                              :<span class="o">=</span> <span class="m">4294967296</span>                          
    uintx MaxNewSize                               :<span class="o">=</span> <span class="m">1431306240</span>                          
    uintx NewSize                                  :<span class="o">=</span> <span class="m">89128960</span>                            
    uintx OldSize                                  :<span class="o">=</span> <span class="m">179306496</span>                           
     intx <span class="nv">ThreadStackSize</span>                           <span class="o">=</span> 1024
</pre></div>


<p>I’m running postgres 9.4 database locally with two separate schemas one for each scalatra and akka-http versions of bootzooka. So database configuration is same for each system. Gatling scenarios are being run on same local machine as bootzooka backends are deployed ( frontend is written in angular and it’s performance is fine). <strong>This configuration is a kind of “lab environment” where network latency and bandwidth doesn’t play any role, there is no data transmission over the wire what often is the main issue of webapp performance.</strong></p>
<ul>
<li><a href="https://github.com/softwaremill/bootzooka/tree/446255c88">Scalatra bootzooka version (tag last-scalatra)</a></li>
<li><a href="https://github.com/softwaremill/bootzooka/tree/83827361">Akka-http bootzooka version for this commit</a></li>
<li><a href="https://github.com/hanskoff/gatling-bootzooka">Repository with simple scenario for the test</a> </li>
</ul>
<h4>Provisioning</h4>
<p>The <code>newbootzooka</code> schema is for akka-http bootzooka version and <code>oldbootzooka</code> schema is for scalatra.</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">DATABASE_URL</span><span class="o">=</span>postgres://newbootzooka:newbootzooka@localhost:5432/newbootzooka <span class="o">&amp;&amp;</span> <span class="se">\</span>
java -Dserver.port<span class="o">=</span><span class="m">8081</span> -Xloggc:newbootzooka-<span class="k">$(</span>date +<span class="s2">&quot;%Y-%m-%d_%H-%M-%S&quot;</span><span class="k">)</span>.log <span class="se">\</span>
-XX:+PrintGCDetails -XX:+PrintGCDateStamps -verbose:gc -jar new-bootzooka/bootzooka.jar

<span class="nb">export</span> <span class="nv">DATABASE_URL</span><span class="o">=</span>postgres://oldbootzooka:oldbootzooka@localhost:5432/oldbootzooka <span class="o">&amp;&amp;</span> <span class="se">\</span>
java -Dembedded-jetty.port<span class="o">=</span><span class="m">8082</span> -Xloggc:oldbootzooka-<span class="k">$(</span>date +<span class="s2">&quot;%Y-%m-%d_%H-%M-%S&quot;</span><span class="k">)</span>.log <span class="se">\</span>
-XX:+PrintGCDetails -XX:+PrintGCDateStamps -verbose:gc -jar old-bootzooka/bootzooka.jar
</pre></div>


<h3>Scenario</h3>
<p>It’s very basic as bootzooka doesn’t do complicated stuff. In the first step user goes to <code>/</code>, waits for http 200 code and in second sends post request (to <code>/api/users/register</code>) to register himself and awaits for <code>success</code> string in response body.</p>
<h4>Scenario setup 1</h4>
<p>Throwing at each system 200 users at once just to see what happens <a href="https://github.com/hanskoff/gatling-bootzooka/blob/master/src/test/scala/pl/jan/BootzookaRegistrationScn.scala">BootzookaRegistrationScn</a></p>
<h3>Bootzooka akka-http version:</h3>
<div class="highlight"><pre><span></span>./gradlew -Dserver.port<span class="o">=</span><span class="m">8081</span> loadTest
</pre></div>


<p>First round results:</p>
<div class="highlight"><pre><span></span><span class="o">================================================================================</span>
---- Global Information --------------------------------------------------------
&gt; request count                                        <span class="m">400</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">387</span>    <span class="nv">KO</span><span class="o">=</span><span class="m">13</span>    <span class="o">)</span>
&gt; min response <span class="nb">time</span>                                     <span class="m">18</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">18</span>     <span class="nv">KO</span><span class="o">=</span><span class="m">111</span>   <span class="o">)</span>
&gt; max response <span class="nb">time</span>                                   <span class="m">3991</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">3991</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">1227</span>  <span class="o">)</span>
&gt; mean response <span class="nb">time</span>                                  <span class="m">1364</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">1397</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">403</span>   <span class="o">)</span>
&gt; std deviation                                       <span class="m">1226</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">1232</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">331</span>   <span class="o">)</span>
&gt; response <span class="nb">time</span> 50th percentile                        <span class="m">957</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">1103</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">333</span>   <span class="o">)</span>
&gt; response <span class="nb">time</span> 75th percentile                       <span class="m">2445</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">2446</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">552</span>   <span class="o">)</span>
&gt; mean requests/sec                                 79.586 <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">77</span>     <span class="nv">KO</span><span class="o">=</span>2.587 <span class="o">)</span>
---- Response Time Distribution ------------------------------------------------
&gt; t &lt; <span class="m">800</span> ms                                           <span class="m">170</span> <span class="o">(</span> 43%<span class="o">)</span>
&gt; <span class="m">800</span> ms &lt; t &lt; <span class="m">1200</span> ms                                  <span class="m">33</span> <span class="o">(</span>  8%<span class="o">)</span>
&gt; t &gt; <span class="m">1200</span> ms                                          <span class="m">184</span> <span class="o">(</span> 46%<span class="o">)</span>
&gt; failed                                                <span class="m">13</span> <span class="o">(</span>  3%<span class="o">)</span>
---- Errors --------------------------------------------------------------------
&gt; java.net.ConnectException: Connection reset by peer                <span class="m">13</span> <span class="o">(</span>100.0%<span class="o">)</span>
<span class="o">================================================================================</span>
</pre></div>


<p>You can see there was 400 requests as each user makes 2 requests.
There were 13 timeouts, so maybe because of JIT compilation, let's run test a second round:</p>
<div class="highlight"><pre><span></span><span class="o">================================================================================</span>
---- Global Information --------------------------------------------------------
&gt; request count                                        <span class="m">400</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">400</span>    <span class="nv">KO</span><span class="o">=</span><span class="m">0</span>     <span class="o">)</span>
&gt; min response <span class="nb">time</span>                                      <span class="m">7</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">7</span>      <span class="nv">KO</span><span class="o">=</span>-     <span class="o">)</span>
&gt; max response <span class="nb">time</span>                                    <span class="m">679</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">679</span>    <span class="nv">KO</span><span class="o">=</span>-     <span class="o">)</span>
&gt; mean response <span class="nb">time</span>                                   <span class="m">193</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">193</span>    <span class="nv">KO</span><span class="o">=</span>-     <span class="o">)</span>
&gt; std deviation                                        <span class="m">215</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">215</span>    <span class="nv">KO</span><span class="o">=</span>-     <span class="o">)</span>
&gt; response <span class="nb">time</span> 50th percentile                         <span class="m">45</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">45</span>     <span class="nv">KO</span><span class="o">=</span>-     <span class="o">)</span>
&gt; response <span class="nb">time</span> 75th percentile                        <span class="m">404</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">404</span>    <span class="nv">KO</span><span class="o">=</span>-     <span class="o">)</span>
&gt; mean requests/sec                                171.969 <span class="o">(</span><span class="nv">OK</span><span class="o">=</span>171.969 <span class="nv">KO</span><span class="o">=</span>-     <span class="o">)</span>
---- Response Time Distribution ------------------------------------------------
&gt; t &lt; <span class="m">800</span> ms                                           <span class="m">400</span> <span class="o">(</span>100%<span class="o">)</span>
&gt; <span class="m">800</span> ms &lt; t &lt; <span class="m">1200</span> ms                                   <span class="m">0</span> <span class="o">(</span>  0%<span class="o">)</span>
&gt; t &gt; <span class="m">1200</span> ms                                            <span class="m">0</span> <span class="o">(</span>  0%<span class="o">)</span>
&gt; failed                                                 <span class="m">0</span> <span class="o">(</span>  0%<span class="o">)</span>
<span class="o">================================================================================</span>
</pre></div>


<p>Looks good, how about doubling number to 400 users at once, third round:</p>
<div class="highlight"><pre><span></span><span class="o">================================================================================</span>
---- Global Information --------------------------------------------------------
&gt; request count                                        <span class="m">800</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">800</span>    <span class="nv">KO</span><span class="o">=</span><span class="m">0</span>     <span class="o">)</span>
&gt; min response <span class="nb">time</span>                                      <span class="m">7</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">7</span>      <span class="nv">KO</span><span class="o">=</span>-     <span class="o">)</span>
&gt; max response <span class="nb">time</span>                                   <span class="m">1443</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">1443</span>   <span class="nv">KO</span><span class="o">=</span>-     <span class="o">)</span>
&gt; mean response <span class="nb">time</span>                                   <span class="m">440</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">440</span>    <span class="nv">KO</span><span class="o">=</span>-     <span class="o">)</span>
&gt; std deviation                                        <span class="m">471</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">471</span>    <span class="nv">KO</span><span class="o">=</span>-     <span class="o">)</span>
&gt; response <span class="nb">time</span> 50th percentile                        <span class="m">200</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">200</span>    <span class="nv">KO</span><span class="o">=</span>-     <span class="o">)</span>
&gt; response <span class="nb">time</span> 75th percentile                        <span class="m">920</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">920</span>    <span class="nv">KO</span><span class="o">=</span>-     <span class="o">)</span>
&gt; mean requests/sec                                212.993 <span class="o">(</span><span class="nv">OK</span><span class="o">=</span>212.993 <span class="nv">KO</span><span class="o">=</span>-     <span class="o">)</span>
---- Response Time Distribution ------------------------------------------------
&gt; t &lt; <span class="m">800</span> ms                                           <span class="m">541</span> <span class="o">(</span> 68%<span class="o">)</span>
&gt; <span class="m">800</span> ms &lt; t &lt; <span class="m">1200</span> ms                                 <span class="m">183</span> <span class="o">(</span> 23%<span class="o">)</span>
&gt; t &gt; <span class="m">1200</span> ms                                           <span class="m">76</span> <span class="o">(</span> 10%<span class="o">)</span>
&gt; failed                                                 <span class="m">0</span> <span class="o">(</span>  0%<span class="o">)</span>
<span class="o">================================================================================</span>
</pre></div>


<p>No failed requests, mean req/sec ~ 212. Let's double users for forth round:</p>
<div class="highlight"><pre><span></span><span class="o">================================================================================</span>
---- Global Information --------------------------------------------------------
&gt; request count                                       <span class="m">1600</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">1565</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">35</span>    <span class="o">)</span>
&gt; min response <span class="nb">time</span>                                      <span class="m">4</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">4</span>      <span class="nv">KO</span><span class="o">=</span><span class="m">159</span>   <span class="o">)</span>
&gt; max response <span class="nb">time</span>                                   <span class="m">4167</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">4167</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">1625</span>  <span class="o">)</span>
&gt; mean response <span class="nb">time</span>                                  <span class="m">1016</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">1016</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">991</span>   <span class="o">)</span>
&gt; std deviation                                       <span class="m">1032</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">1041</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">428</span>   <span class="o">)</span>
&gt; response <span class="nb">time</span> 50th percentile                        <span class="m">896</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">895</span>    <span class="nv">KO</span><span class="o">=</span><span class="m">1285</span>  <span class="o">)</span>
&gt; response <span class="nb">time</span> 75th percentile                       <span class="m">1515</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">1519</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">1288</span>  <span class="o">)</span>
&gt; mean requests/sec                                228.571 <span class="o">(</span><span class="nv">OK</span><span class="o">=</span>223.571 <span class="nv">KO</span><span class="o">=</span><span class="m">5</span>     <span class="o">)</span>
---- Response Time Distribution ------------------------------------------------
&gt; t &lt; <span class="m">800</span> ms                                           <span class="m">720</span> <span class="o">(</span> 45%<span class="o">)</span>
&gt; <span class="m">800</span> ms &lt; t &lt; <span class="m">1200</span> ms                                 <span class="m">157</span> <span class="o">(</span> 10%<span class="o">)</span>
&gt; t &gt; <span class="m">1200</span> ms                                          <span class="m">688</span> <span class="o">(</span> 43%<span class="o">)</span>
&gt; failed                                                <span class="m">35</span> <span class="o">(</span>  2%<span class="o">)</span>
---- Errors --------------------------------------------------------------------
&gt; java.net.ConnectException: Connection reset by peer                <span class="m">35</span> <span class="o">(</span>100.0%<span class="o">)</span>
<span class="o">================================================================================</span>
</pre></div>


<p>2% of failed requests but no error in logs (maybe we don't handle that case yet). And in logs I've found:</p>
<div class="highlight"><pre><span></span>java.sql.SQLTimeoutException: Timeout after 1015ms of waiting for a connection.
</pre></div>


<p>and more:</p>
<p>13:53:45.304 [main-akka.actor.default-dispatcher-82] ERROR c.s.b.Main$$anon$1 - Exception during client request processing: Task slick.backend.DatabaseComponent$DatabaseDef$$anon$2@71688eb2 rejected from java.util.concurrent.ThreadPoolExecutor@4131e49e[Running, pool size = 20, active threads = 20, queued tasks = 1000, completed tasks = 4067]</p>
<p>Let's repeat, same setup, fifth round:</p>
<div class="highlight"><pre><span></span><span class="o">================================================================================</span>
---- Global Information --------------------------------------------------------
&gt; request count                                       <span class="m">1600</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">1600</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">0</span>     <span class="o">)</span>
&gt; min response <span class="nb">time</span>                                      <span class="m">4</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">4</span>      <span class="nv">KO</span><span class="o">=</span>-     <span class="o">)</span>
&gt; max response <span class="nb">time</span>                                   <span class="m">1905</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">1905</span>   <span class="nv">KO</span><span class="o">=</span>-     <span class="o">)</span>
&gt; mean response <span class="nb">time</span>                                   <span class="m">378</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">378</span>    <span class="nv">KO</span><span class="o">=</span>-     <span class="o">)</span>
&gt; std deviation                                        <span class="m">631</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">631</span>    <span class="nv">KO</span><span class="o">=</span>-     <span class="o">)</span>
&gt; response <span class="nb">time</span> 50th percentile                         <span class="m">57</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">57</span>     <span class="nv">KO</span><span class="o">=</span>-     <span class="o">)</span>
&gt; response <span class="nb">time</span> 75th percentile                        <span class="m">300</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">300</span>    <span class="nv">KO</span><span class="o">=</span>-     <span class="o">)</span>
&gt; mean requests/sec                                225.384 <span class="o">(</span><span class="nv">OK</span><span class="o">=</span>225.384 <span class="nv">KO</span><span class="o">=</span>-     <span class="o">)</span>
---- Response Time Distribution ------------------------------------------------
&gt; t &lt; <span class="m">800</span> ms                                          <span class="m">1310</span> <span class="o">(</span> 82%<span class="o">)</span>
&gt; <span class="m">800</span> ms &lt; t &lt; <span class="m">1200</span> ms                                  <span class="m">23</span> <span class="o">(</span>  1%<span class="o">)</span>
&gt; t &gt; <span class="m">1200</span> ms                                          <span class="m">267</span> <span class="o">(</span> 17%<span class="o">)</span>
&gt; failed                                                 <span class="m">0</span> <span class="o">(</span>  0%<span class="o">)</span>
<span class="o">================================================================================</span>
</pre></div>


<p>No failed requests this time,75th percentile means: 75% of requests handled within below 300 milliseconds.</p>
<h3>Bootzooka scalatra version:</h3>
<div class="highlight"><pre><span></span>./gradlew -Dserver.port<span class="o">=</span><span class="m">8082</span> loadTest
</pre></div>


<p>First round: </p>
<div class="highlight"><pre><span></span><span class="o">================================================================================</span>
---- Global Information --------------------------------------------------------
&gt; request count                                        <span class="m">400</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">284</span>    <span class="nv">KO</span><span class="o">=</span><span class="m">116</span>   <span class="o">)</span>
&gt; min response <span class="nb">time</span>                                     <span class="m">61</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">61</span>     <span class="nv">KO</span><span class="o">=</span><span class="m">10486</span> <span class="o">)</span>
&gt; max response <span class="nb">time</span>                                  <span class="m">11823</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">11823</span>  <span class="nv">KO</span><span class="o">=</span><span class="m">11805</span> <span class="o">)</span>
&gt; mean response <span class="nb">time</span>                                  <span class="m">5800</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">3502</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">11426</span> <span class="o">)</span>
&gt; std deviation                                       <span class="m">5640</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">5156</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">199</span>   <span class="o">)</span>
&gt; response <span class="nb">time</span> 50th percentile                       <span class="m">1747</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">224</span>    <span class="nv">KO</span><span class="o">=</span><span class="m">11447</span> <span class="o">)</span>
&gt; response <span class="nb">time</span> 75th percentile                      <span class="m">11470</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">11334</span>  <span class="nv">KO</span><span class="o">=</span><span class="m">11571</span> <span class="o">)</span>
&gt; mean requests/sec                                 31.464 <span class="o">(</span><span class="nv">OK</span><span class="o">=</span>22.339 <span class="nv">KO</span><span class="o">=</span>9.125 <span class="o">)</span>
---- Response Time Distribution ------------------------------------------------
&gt; t &lt; <span class="m">800</span> ms                                           <span class="m">200</span> <span class="o">(</span> 50%<span class="o">)</span>
&gt; <span class="m">800</span> ms &lt; t &lt; <span class="m">1200</span> ms                                   <span class="m">0</span> <span class="o">(</span>  0%<span class="o">)</span>
&gt; t &gt; <span class="m">1200</span> ms                                           <span class="m">84</span> <span class="o">(</span> 21%<span class="o">)</span>
&gt; failed                                               <span class="m">116</span> <span class="o">(</span> 29%<span class="o">)</span>
---- Errors --------------------------------------------------------------------
&gt; regex<span class="o">(</span>success<span class="o">)</span>.find<span class="o">(</span>0<span class="o">)</span>.exists, found nothing                      <span class="m">116</span> <span class="o">(</span>100.0%<span class="o">)</span>
<span class="o">================================================================================</span>
</pre></div>


<p>116 failed request, same case let's give a JIT a chance. Second round: </p>
<div class="highlight"><pre><span></span><span class="o">================================================================================</span>
---- Global Information --------------------------------------------------------
&gt; request count                                        <span class="m">400</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">327</span>    <span class="nv">KO</span><span class="o">=</span><span class="m">73</span>    <span class="o">)</span>
&gt; min response <span class="nb">time</span>                                      <span class="m">1</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">1</span>      <span class="nv">KO</span><span class="o">=</span><span class="m">4298</span>  <span class="o">)</span>
&gt; max response <span class="nb">time</span>                                   <span class="m">5015</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">5015</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">4773</span>  <span class="o">)</span>
&gt; mean response <span class="nb">time</span>                                  <span class="m">2016</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">1449</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">4556</span>  <span class="o">)</span>
&gt; std deviation                                       <span class="m">2279</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">2143</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">101</span>   <span class="o">)</span>
&gt; response <span class="nb">time</span> 50th percentile                         <span class="m">67</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">53</span>     <span class="nv">KO</span><span class="o">=</span><span class="m">4576</span>  <span class="o">)</span>
&gt; response <span class="nb">time</span> 75th percentile                       <span class="m">4623</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">4583</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">4627</span>  <span class="o">)</span>
&gt; mean requests/sec                                 67.261 <span class="o">(</span><span class="nv">OK</span><span class="o">=</span>54.986 <span class="nv">KO</span><span class="o">=</span>12.275<span class="o">)</span>
---- Response Time Distribution ------------------------------------------------
&gt; t &lt; <span class="m">800</span> ms                                           <span class="m">222</span> <span class="o">(</span> 56%<span class="o">)</span>
&gt; <span class="m">800</span> ms &lt; t &lt; <span class="m">1200</span> ms                                   <span class="m">6</span> <span class="o">(</span>  2%<span class="o">)</span>
&gt; t &gt; <span class="m">1200</span> ms                                           <span class="m">99</span> <span class="o">(</span> 25%<span class="o">)</span>
&gt; failed                                                <span class="m">73</span> <span class="o">(</span> 18%<span class="o">)</span>
---- Errors --------------------------------------------------------------------
&gt; regex<span class="o">(</span>success<span class="o">)</span>.find<span class="o">(</span>0<span class="o">)</span>.exists, found nothing                       <span class="m">73</span> <span class="o">(</span>100.0%<span class="o">)</span>
<span class="o">================================================================================</span>
</pre></div>


<p>73 failed, ok it's better then 116 but let's keep it warming. Third round: </p>
<div class="highlight"><pre><span></span><span class="o">================================================================================</span>
---- Global Information --------------------------------------------------------
&gt; request count                                        <span class="m">400</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">357</span>    <span class="nv">KO</span><span class="o">=</span><span class="m">43</span>    <span class="o">)</span>
&gt; min response <span class="nb">time</span>                                      <span class="m">1</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">1</span>      <span class="nv">KO</span><span class="o">=</span><span class="m">3261</span>  <span class="o">)</span>
&gt; max response <span class="nb">time</span>                                   <span class="m">3929</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">3929</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">3667</span>  <span class="o">)</span>
&gt; mean response <span class="nb">time</span>                                  <span class="m">1505</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">1269</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">3463</span>  <span class="o">)</span>
&gt; std deviation                                       <span class="m">1626</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">1563</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">109</span>   <span class="o">)</span>
&gt; response <span class="nb">time</span> 50th percentile                        <span class="m">291</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">250</span>    <span class="nv">KO</span><span class="o">=</span><span class="m">3468</span>  <span class="o">)</span>
&gt; response <span class="nb">time</span> 75th percentile                       <span class="m">3507</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">3462</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">3553</span>  <span class="o">)</span>
&gt; mean requests/sec                                  80.89 <span class="o">(</span><span class="nv">OK</span><span class="o">=</span>72.194 <span class="nv">KO</span><span class="o">=</span>8.696 <span class="o">)</span>
---- Response Time Distribution ------------------------------------------------
&gt; t &lt; <span class="m">800</span> ms                                           <span class="m">229</span> <span class="o">(</span> 57%<span class="o">)</span>
&gt; <span class="m">800</span> ms &lt; t &lt; <span class="m">1200</span> ms                                   <span class="m">9</span> <span class="o">(</span>  2%<span class="o">)</span>
&gt; t &gt; <span class="m">1200</span> ms                                          <span class="m">119</span> <span class="o">(</span> 30%<span class="o">)</span>
&gt; failed                                                <span class="m">43</span> <span class="o">(</span> 11%<span class="o">)</span>
---- Errors --------------------------------------------------------------------
&gt; regex<span class="o">(</span>success<span class="o">)</span>.find<span class="o">(</span>0<span class="o">)</span>.exists, found nothing                       <span class="m">43</span> <span class="o">(</span>100.0%<span class="o">)</span>
<span class="o">================================================================================</span>
</pre></div>


<p>43 failed, number is decreasing but we see mean 80 req/sec with 11% of failures. Forth round:</p>
<div class="highlight"><pre><span></span><span class="o">================================================================================</span>
---- Global Information --------------------------------------------------------
&gt; request count                                        <span class="m">400</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">339</span>    <span class="nv">KO</span><span class="o">=</span><span class="m">61</span>    <span class="o">)</span>
&gt; min response <span class="nb">time</span>                                      <span class="m">1</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">1</span>      <span class="nv">KO</span><span class="o">=</span><span class="m">2005</span>  <span class="o">)</span>
&gt; max response <span class="nb">time</span>                                   <span class="m">5830</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">5830</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">5528</span>  <span class="o">)</span>
&gt; mean response <span class="nb">time</span>                                  <span class="m">2162</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">1648</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">5021</span>  <span class="o">)</span>
&gt; std deviation                                       <span class="m">2601</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">2466</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">957</span>   <span class="o">)</span>
&gt; response <span class="nb">time</span> 50th percentile                         <span class="m">61</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">21</span>     <span class="nv">KO</span><span class="o">=</span><span class="m">5370</span>  <span class="o">)</span>
&gt; response <span class="nb">time</span> 75th percentile                       <span class="m">5412</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">5318</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">5451</span>  <span class="o">)</span>
&gt; mean requests/sec                                 58.651 <span class="o">(</span><span class="nv">OK</span><span class="o">=</span>49.707 <span class="nv">KO</span><span class="o">=</span>8.944 <span class="o">)</span>
---- Response Time Distribution ------------------------------------------------
&gt; t &lt; <span class="m">800</span> ms                                           <span class="m">230</span> <span class="o">(</span> 58%<span class="o">)</span>
&gt; <span class="m">800</span> ms &lt; t &lt; <span class="m">1200</span> ms                                   <span class="m">7</span> <span class="o">(</span>  2%<span class="o">)</span>
&gt; t &gt; <span class="m">1200</span> ms                                          <span class="m">102</span> <span class="o">(</span> 26%<span class="o">)</span>
&gt; failed                                                <span class="m">61</span> <span class="o">(</span> 15%<span class="o">)</span>
---- Errors --------------------------------------------------------------------
&gt; regex<span class="o">(</span>success<span class="o">)</span>.find<span class="o">(</span>0<span class="o">)</span>.exists, found nothing                       <span class="m">61</span> <span class="o">(</span>100.0%<span class="o">)</span>
<span class="o">================================================================================</span>
</pre></div>


<p>61 failed, looks like won't be better, however let's double users to compare it with akka-http system. Fifth round:</p>
<p>400 requests at once:</p>
<div class="highlight"><pre><span></span><span class="o">================================================================================</span>
---- Global Information --------------------------------------------------------
&gt; request count                                        <span class="m">800</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">572</span>    <span class="nv">KO</span><span class="o">=</span><span class="m">228</span>   <span class="o">)</span>
&gt; min response <span class="nb">time</span>                                      <span class="m">1</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">1</span>      <span class="nv">KO</span><span class="o">=</span><span class="m">1993</span>  <span class="o">)</span>
&gt; max response <span class="nb">time</span>                                  <span class="m">14464</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">14464</span>  <span class="nv">KO</span><span class="o">=</span><span class="m">14065</span> <span class="o">)</span>
&gt; mean response <span class="nb">time</span>                                  <span class="m">5533</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">2370</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">13468</span> <span class="o">)</span>
&gt; std deviation                                       <span class="m">6667</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">5087</span>   <span class="nv">KO</span><span class="o">=</span><span class="m">1723</span>  <span class="o">)</span>
&gt; response <span class="nb">time</span> 50th percentile                        <span class="m">116</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">35</span>     <span class="nv">KO</span><span class="o">=</span><span class="m">13728</span> <span class="o">)</span>
&gt; response <span class="nb">time</span> 75th percentile                      <span class="m">13715</span> <span class="o">(</span><span class="nv">OK</span><span class="o">=</span><span class="m">144</span>    <span class="nv">KO</span><span class="o">=</span><span class="m">13827</span> <span class="o">)</span>
&gt; mean requests/sec                                 50.614 <span class="o">(</span><span class="nv">OK</span><span class="o">=</span>36.189 <span class="nv">KO</span><span class="o">=</span>14.425<span class="o">)</span>
---- Response Time Distribution ------------------------------------------------
&gt; t &lt; <span class="m">800</span> ms                                           <span class="m">458</span> <span class="o">(</span> 57%<span class="o">)</span>
&gt; <span class="m">800</span> ms &lt; t &lt; <span class="m">1200</span> ms                                   <span class="m">5</span> <span class="o">(</span>  1%<span class="o">)</span>
&gt; t &gt; <span class="m">1200</span> ms                                          <span class="m">109</span> <span class="o">(</span> 14%<span class="o">)</span>
&gt; failed                                               <span class="m">228</span> <span class="o">(</span> 29%<span class="o">)</span>
---- Errors --------------------------------------------------------------------
&gt; regex<span class="o">(</span>success<span class="o">)</span>.find<span class="o">(</span>0<span class="o">)</span>.exists, found nothing                      <span class="m">228</span> <span class="o">(</span>100.0%<span class="o">)</span>
<span class="o">================================================================================</span>
</pre></div>


<p>50 mean req/sec with 29% of failed and in app logs I see:</p>
<div class="highlight"><pre><span></span>java.sql.SQLTimeoutException: Timeout after 1003ms of waiting for a connection.
</pre></div>


<h4>Memory usage</h4>
<p>In both cases, memory usage is comparable, I saw same 99.97% of jvm code throughput and even almost same number of GC pauses. I have two files but nothing spectacular here. The upper window is akka-http bootzooka version the lower is scalatra version.</p>
<p><img alt="GCviewer bootzooka comparision" src="https://hanskoff.github.io/blog/img/gcviewer.png" /></p>
<ul>
<li>newjvm-2016-03-29_15-11-42.log</li>
<li>oldjvm-2016-03-29_15-33-13.log</li>
</ul>
<h3>Conclusion after scenario setup 1</h3>
<p>This first scenario setup is naive and should show "something" and that is <code>akka-http app behaves better than scalatra</code> and continue to operate while getting bigger traffic too. Akka-http stops responding under much bigger load 800 users vs scalatra 200 users (mean 225 req/sec vs 50-80req/sec). It looks like akka-http version has better default configuration (thread pool size) and integrates well with <a href="http://slick.typesafe.com/">slick</a> (functional relational mapping tool) and hikari-cp (tool that managed database connection pool) which overall handles resources in more efficient way.</p>
<style type="text/css">
table {
  padding: 0; }
  table tr {
    border-top: 1px solid #cccccc;
    background-color: white;
    margin: 0;
    padding: 0; }
    table tr:nth-child(2n) {
      background-color: #f8f8f8; }
    table tr th {
      font-weight: bold;
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr td {
      border: 1px solid #cccccc;
      text-align: left;
      margin: 0;
      padding: 6px 13px; }
    table tr th :first-child, table tr td :first-child {
      margin-top: 0; }
    table tr th :last-child, table tr td :last-child {
      margin-bottom: 0; }
</style>

<h4>Comparison of second round of both frameworks:</h4>
<p>For comparison I've used <a href="https://github.com/nuxeo/gatling-report">gatling-reports</a> and the <a href="https://github.com/nuxeo/gatling-report#output-csv-stats">legend</a>.</p>
<table>
<thead>
<tr>
<th align="center">simulation</th>
<th align="center">duration</th>
<th align="center">successCount</th>
<th align="center">errorCount</th>
<th align="center">min</th>
<th align="center">p50</th>
<th align="center">p95</th>
<th align="center">p99</th>
<th align="center">max</th>
<th align="center">avg</th>
<th align="center">stddev</th>
<th align="center">requestPerSecond</th>
<th align="center">apdex</th>
<th align="center">rating</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">akka-http</td>
<td align="center">1.98</td>
<td align="center">400</td>
<td align="center">0</td>
<td align="center">4</td>
<td align="center">43</td>
<td align="center">581</td>
<td align="center">678</td>
<td align="center">679</td>
<td align="center">191.2</td>
<td align="center">217</td>
<td align="center">201.71</td>
<td align="center">1</td>
<td align="center">Excellent</td>
</tr>
<tr>
<td align="center">scalatra</td>
<td align="center">5.48</td>
<td align="center">327</td>
<td align="center">73</td>
<td align="center">0</td>
<td align="center">65</td>
<td align="center">4901</td>
<td align="center">4984</td>
<td align="center">5015</td>
<td align="center">2014.55</td>
<td align="center">2284</td>
<td align="center">59.73</td>
<td align="center">0.79</td>
<td align="center">Fair</td>
</tr>
</tbody>
</table>
<ul>
<li>duration = seconds</li>
<li>succesCount = number of requests</li>
<li>min, p50, p95, p99, max, avg, stddev = miliseconds</li>
</ul>
<table>
<thead>
<tr>
<th>test duration (test takes longer when errors appear)</th>
<th>duration &amp; throughput</th>
</tr>
</thead>
<tbody>
<tr>
<td><img alt="second round bootzooka comparision" src="https://hanskoff.github.io/blog/img/secondRoundDuration.png" /></td>
<td><img alt="second round bootzooka comparision" src="https://hanskoff.github.io/blog/img/secondRoundRps.png" /></td>
</tr>
</tbody>
</table>
<h4>Comparison of best runs for 200 users:</h4>
<table>
<thead>
<tr>
<th align="center">simulation</th>
<th align="center">duration</th>
<th align="center">successCount</th>
<th align="center">errorCount</th>
<th align="center">min</th>
<th align="center">p50</th>
<th align="center">p95</th>
<th align="center">p99</th>
<th align="center">max</th>
<th align="center">avg</th>
<th align="center">stddev</th>
<th align="center">requestPerSecond</th>
<th align="center">apdex</th>
<th align="center">rating</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">akka-http</td>
<td align="center">1.98</td>
<td align="center">400</td>
<td align="center">0</td>
<td align="center">4</td>
<td align="center">43</td>
<td align="center">581</td>
<td align="center">678</td>
<td align="center">679</td>
<td align="center">191.2</td>
<td align="center">217</td>
<td align="center">201.71</td>
<td align="center">1</td>
<td align="center">Excellent</td>
</tr>
<tr>
<td align="center">scalatra</td>
<td align="center">4.49</td>
<td align="center">357</td>
<td align="center">43</td>
<td align="center">0</td>
<td align="center">259</td>
<td align="center">3770</td>
<td align="center">3869</td>
<td align="center">3928</td>
<td align="center">1473.31</td>
<td align="center">1654</td>
<td align="center">79.49</td>
<td align="center">0.8</td>
<td align="center">Fair</td>
</tr>
</tbody>
</table>
<h4>Comparison for 400 users:</h4>
<table>
<thead>
<tr>
<th align="center">simulation</th>
<th align="center">duration</th>
<th align="center">successCount</th>
<th align="center">errorCount</th>
<th align="center">min</th>
<th align="center">p50</th>
<th align="center">p95</th>
<th align="center">p99</th>
<th align="center">max</th>
<th align="center">avg</th>
<th align="center">stddev</th>
<th align="center">requestPerSecond</th>
<th align="center">apdex</th>
<th align="center">rating</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">akka-http</td>
<td align="center">3.41</td>
<td align="center">800</td>
<td align="center">0</td>
<td align="center">4</td>
<td align="center">199</td>
<td align="center">1390</td>
<td align="center">1438</td>
<td align="center">1443</td>
<td align="center">436.42</td>
<td align="center">474</td>
<td align="center">234.33</td>
<td align="center">1</td>
<td align="center">Excellent</td>
</tr>
<tr>
<td align="center">scalatra</td>
<td align="center">15.33</td>
<td align="center">572</td>
<td align="center">228</td>
<td align="center">0</td>
<td align="center">111</td>
<td align="center">14156</td>
<td align="center">14398</td>
<td align="center">14464</td>
<td align="center">5529.42</td>
<td align="center">6674</td>
<td align="center">37.3</td>
<td align="center">0.59</td>
<td align="center">Poor</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>test duration (test takes longer when errors appear)</th>
<th>duration &amp; throughput</th>
</tr>
</thead>
<tbody>
<tr>
<td><img alt="second round bootzooka comparision" src="https://hanskoff.github.io/blog/img/finalRoundDuration.png" /></td>
<td><img alt="second round bootzooka comparision" src="https://hanskoff.github.io/blog/img/finalRoundRps.png" /></td>
</tr>
</tbody>
</table>
<h4>Comparison for 800 users (where akka-http started to have a problems):</h4>
<table>
<thead>
<tr>
<th align="center">simulation</th>
<th align="center">duration</th>
<th align="center">successCount</th>
<th align="center">errorCount</th>
<th align="center">min</th>
<th align="center">p50</th>
<th align="center">p95</th>
<th align="center">p99</th>
<th align="center">max</th>
<th align="center">avg</th>
<th align="center">stddev</th>
<th align="center">requestPerSecond</th>
<th align="center">apdex</th>
<th align="center">rating</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">akka-http</td>
<td align="center">8.69</td>
<td align="center">1564</td>
<td align="center">36</td>
<td align="center">4</td>
<td align="center">418</td>
<td align="center">3095</td>
<td align="center">3296</td>
<td align="center">3345</td>
<td align="center">1011.16</td>
<td align="center">1117</td>
<td align="center">180.06</td>
<td align="center">0.85</td>
<td align="center">Fair</td>
</tr>
</tbody>
</table>
<h4>Hints for tuning</h4>
<p>Very often performance tests reveal that access to database is a bottleneck. In second (scalatra) of above cases we can observe it quite soon. </p>
<p>First natural approach is to increase the database connection pool what should suffice for a while. Increasing timeout is highly undesirable because it would only slow everything down. Another practise (this time expensive) is to set a database cluster or/and queue updates and queries to database. But any of that moves requires expertise knowledge in every of touched areas (like distributed setup of databases and applications). But that is not the case here, tests are being run on defaults.</p>
<hr />
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'hanskoff'; // required: replace example with your forum shortname

                    var disqus_identifier = 'bootzooka-akka-http-vs-scalatra';
                var disqus_url = 'https://hanskoff.github.io/bootzooka-akka-http-vs-scalatra.html';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2016 johny
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://hanskoff.github.io/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://hanskoff.github.io/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://hanskoff.github.io/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'hanskoff'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-20629244-7']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->

</body>
</html>